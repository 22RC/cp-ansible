#mkdir -p /var/ssl/private



openssl req -new -x509 \
  -keyout ca-key \
  -out ca-cert \
  -days 720 \
  -subj '/CN=ca1.test.confluent.io/OU=TEST/O=CONFLUENT/L=PaloAlto/S=Ca/C=US' \
  -passin pass:capass -passout pass:capass



keytool -keystore kafka.server.truststore.bcfks -storetype BCFKS \
  -alias CARoot -importcert -file ca-cert \
  -noprompt  \
  -storepass trustpass \
  -keypass trustpass \
  -providerpath /usr/share/java/kafka/bc-fips-1.0.2.jar \
  -providerclass org.bouncycastle.jcajce.provider.BouncyCastleFipsProvider


keytool -keystore kafka.server.keystore.bcfks -alias localhost \
  -validity 720 -genkeypair -keyalg RSA -keysize 2048 \
  -storepass keypass -keypass keypass \
  -storetype BCFKS \
  -providerpath /usr/share/java/kafka/bc-fips-1.0.2.jar \
  -providerclass org.bouncycastle.jcajce.provider.BouncyCastleFipsProvider -dname CN=ip-172-31-44-124.us-west-2.compute.internal -ext SAN=DNS:ip-172-31-44-124.us-west-2.compute.internal

keytool -keystore kafka.server.keystore.bcfks -alias localhost \
  -storepass keypass -keypass keypass \
  -storetype BCFKS -certreq -file cert-file \
  -providerpath /usr/share/java/kafka/bc-fips-1.0.2.jar \
  -providerclass org.bouncycastle.jcajce.provider.BouncyCastleFipsProvider

openssl x509 -req -CA ca-cert -CAkey ca-key \
  -in cert-file -out cert-signed -days 720 -CAcreateserial -passin pass:capassword123

keytool -keystore kafka.server.keystore.bcfks -storetype BCFKS \
  -noprompt \
  -alias CARoot -import -file ca-cert -storepass keypass \
  -providerpath /usr/share/java/kafka/bc-fips-1.0.2.jar \
  -providerclass org.bouncycastle.jcajce.provider.BouncyCastleFipsProvider

cat ca-cert cert-signed > cert

keytool -keystore kafka.server.keystore.bcfks -storetype BCFKS \
  -storepass keypass -alias localhost -import -file cert \
  -noprompt \
  -providerpath /usr/share/java/kafka/bc-fips-1.0.2.jar \
  -providerclass org.bouncycastle.jcajce.provider.BouncyCastleFipsProvider


zookeeper.connect=ip-172-31-46-252.us-west-2.compute.internal:2181,ip-172-31-40-66.us-west-2.compute.internal:2181,ip-172-31-34-230.us-west-2.compute.internal:2181

listener.security.protocol.map = INTERNAL:SSL
listeners = INTERNAL://:9092

inter.broker.listener.name=internal

# TLS/SSL configuration
ssl.keymanager.algorithm=PKIX
ssl.trustmanager.algorithm=PKIX
ssl.keystore.type=BCFKS
ssl.truststore.type=BCFKS
ssl.truststore.location=/tmp/kafka.server.truststore.bcfks
ssl.truststore.password=trustpass
ssl.keystore.location=/tmp/kafka.server.keystore.bcfks
ssl.keystore.password=keypasss
ssl.key.password=keypass

# External listener configuration
listener.name.internal.ssl.keymanager.algorithm=PKIX
listener.name.internal.ssl.trustmanager.algorithm=PKIX
listener.name.internal.ssl.keystore.type=BCFKS
listener.name.internal.ssl.truststore.type=BCFKS
listener.name.internal.ssl.truststore.location=/tmp/kafka.server.truststore.bcfks
listener.name.internal.ssl.truststore.password=trustpass
listener.name.internal.ssl.keystore.location=/tmp/kafka.server.keystore.bcfks
listener.name.internal.ssl.keystore.password=keypass
listener.name.internal.ssl.key.password=keypass

enable.fips=true
security.providers=io.confluent.kafka.security.fips.provider.BcFipsProviderCreator,io.confluent.kafka.security.fips.provider.BcFipsJsseProviderCreator
# Specify the TLS version. Only TLS version 1.2 is supported.
ssl.enabled.protocol=TLSv1.2
